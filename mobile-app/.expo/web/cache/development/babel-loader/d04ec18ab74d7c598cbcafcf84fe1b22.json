{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { PermissionStatus, UnavailabilityError } from 'expo-modules-core';\n\nfunction getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || function () {\n    var error = new Error('Permission unimplemented');\n    error.code = 0;\n    error.name = 'NotAllowedError';\n    throw error;\n  };\n\n  return new Promise(function (resolve, reject) {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction handleGetUserMediaError(_ref) {\n  var message = _ref.message;\n\n  if (message === 'Permission dismissed') {\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false\n    };\n  } else {\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false\n    };\n  }\n}\n\nfunction handleRequestPermissionsAsync() {\n  var message;\n  return _regeneratorRuntime.async(function handleRequestPermissionsAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(getUserMedia({\n            video: true\n          }));\n\n        case 3:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          message = _context.t0.message;\n          return _context.abrupt(\"return\", handleGetUserMediaError({\n            message: message\n          }));\n\n        case 10:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 6]], Promise);\n}\n\nfunction handlePermissionsQueryAsync() {\n  var _navigator, _navigator$permission;\n\n  var _await$navigator$perm, state;\n\n  return _regeneratorRuntime.async(function handlePermissionsQueryAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if ((_navigator = navigator) != null && (_navigator$permission = _navigator.permissions) != null && _navigator$permission.query) {\n            _context2.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('expo-barcode-scanner', 'navigator.permissions API is not available');\n\n        case 2:\n          _context2.next = 4;\n          return _regeneratorRuntime.awrap(navigator.permissions.query({\n            name: 'camera'\n          }));\n\n        case 4:\n          _await$navigator$perm = _context2.sent;\n          state = _await$navigator$perm.state;\n          _context2.t0 = state;\n          _context2.next = _context2.t0 === 'prompt' ? 9 : _context2.t0 === 'granted' ? 10 : _context2.t0 === 'denied' ? 11 : 12;\n          break;\n\n        case 9:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 10:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 11:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 12:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport default {\n  get name() {\n    return 'ExpoBarCodeScannerModule';\n  },\n\n  get BarCodeType() {\n    return {\n      code39mod43: 'code39mod43',\n      code138: 'code138',\n      interleaved2of5: 'interleaved2of5',\n      aztec: 'aztec',\n      ean13: 'ean13',\n      ean8: 'ean8',\n      qr: 'qr',\n      pdf417: 'pdf417',\n      upc_e: 'upc_e',\n      datamatrix: 'datamatrix',\n      code39: 'code39',\n      code93: 'code93',\n      itf14: 'itf14',\n      codabar: 'codabar',\n      code128: 'code128',\n      upc_a: 'upc_a'\n    };\n  },\n\n  get Type() {\n    return {\n      front: 'front',\n      back: 'back'\n    };\n  },\n\n  requestPermissionsAsync: function requestPermissionsAsync() {\n    return function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", handleRequestPermissionsAsync());\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getPermissionsAsync: function getPermissionsAsync() {\n    return function _callee2() {\n      return _regeneratorRuntime.async(function _callee2$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              return _context4.abrupt(\"return\", handlePermissionsQueryAsync());\n\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  }\n};","map":{"version":3,"sources":["../src/ExpoBarCodeScannerModule.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { PermissionResponse, PermissionStatus, UnavailabilityError } from 'expo-modules-core';\n\nfunction getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    // TODO: this method is deprecated, migrate to https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    function () {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction handleGetUserMediaError({ message }: { message: string }): PermissionResponse {\n  // name: NotAllowedError\n  // code: 0\n  if (message === 'Permission dismissed') {\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  } else {\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  }\n}\n\nasync function handleRequestPermissionsAsync(): Promise<PermissionResponse> {\n  try {\n    await getUserMedia({\n      video: true,\n    });\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    return handleGetUserMediaError({ message });\n  }\n}\n\nasync function handlePermissionsQueryAsync(): Promise<PermissionResponse> {\n  if (!navigator?.permissions?.query) {\n    throw new UnavailabilityError(\n      'expo-barcode-scanner',\n      'navigator.permissions API is not available'\n    );\n  }\n\n  const { state } = await navigator.permissions.query({ name: 'camera' });\n  switch (state) {\n    case 'prompt':\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    case 'granted':\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true,\n      };\n    case 'denied':\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n  }\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoBarCodeScannerModule';\n  },\n  get BarCodeType() {\n    return {\n      code39mod43: 'code39mod43',\n      code138: 'code138',\n      interleaved2of5: 'interleaved2of5',\n      aztec: 'aztec',\n      ean13: 'ean13',\n      ean8: 'ean8',\n      qr: 'qr',\n      pdf417: 'pdf417',\n      upc_e: 'upc_e',\n      datamatrix: 'datamatrix',\n      code39: 'code39',\n      code93: 'code93',\n      itf14: 'itf14',\n      codabar: 'codabar',\n      code128: 'code128',\n      upc_a: 'upc_a',\n    };\n  },\n  get Type() {\n    return { front: 'front', back: 'back' };\n  },\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return handleRequestPermissionsAsync();\n  },\n  async getPermissionsAsync(): Promise<PermissionResponse> {\n    return handlePermissionsQueryAsync();\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}